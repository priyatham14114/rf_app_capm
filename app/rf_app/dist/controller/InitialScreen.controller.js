sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/Device","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,s,i,n,o){"use strict";return e.extend("com.app.rfapp.controller.InitialScreen",{onInit:function(){this.loadConfiguredSystems();this.aAllButtons=[];this.currentIndex=0},onsapCancelPress:function(){this.oConfigSap.close()},LoadSapLogon:async function(){this.oConfigSap??=await this.loadFragment({name:"com.app.rfapp.fragments.SapLogon"});this.oConfigSap.open();this.onUserLogin()},handleLinksapPress:async function(){this.oConnetSap??=await this.loadFragment({name:"com.app.rfapp.fragments.ConnecttoSAP"});this.getView().byId("idconnectsapfinishButton").setVisible(true);this.getView().byId("idconnectsapeditButton").setVisible(false);this.oConnetSap.open()},handleAddPress:function(){this.handleLinksapPress()},onCloseconnectsap:function(){this.oConnetSap.close();var e=this.getView();e.byId("idDescriptionInput").setValueState("None");e.byId("idSystemIdInput").setValueState("None");e.byId("idInstanceNumberInput").setValueState("None");e.byId("idClientInput").setValueState("None");e.byId("idApplicationServerInput").setValueState("None");this.clearInputFields(e)},onsapsubmitPress:function(){var e=this.getView().byId("idsaplogonUserId").getValue();var t=this.getView().byId("idSapLogonPassword").getValue();if(e==="111010"&&t==="ARTIHCUS"){this.getOwnerComponent().getRouter().navTo("Homepage",{id:e})}},onExit:function(){this.onUserLogin()},onUserLogin:function(){this.getView().byId("idsaplogonUserId").setValue();this.getView().byId("idSapLogonPassword").setValue()},onFinishconnectSAPPressS:function(){var e=this.getView();var t=e.byId("idDescriptionInput").getValue();var i=e.byId("idSystemIdInput").getValue();var n=e.byId("idInstanceNumberInput").getValue();var o=e.byId("idClientInput").getValue();var r=e.byId("idApplicationServerInput").getValue();var a=e.byId("idRouterStringInput").getValue();var u=e.byId("idServiceInput").getValue();var d=e.byId("idCheckboxDescription");var l={Description:t,SystemId:i,InstanceNo:n,Client:o,AppServer:r,SapRouterStr:a,SapService:u};const c=this.getView().getModel();const p=this.getView().getModel("ModelV2");p.create("/ServiceSet",l,{success:function(){s.show("Entry created successfully!")},error:function(){s.show("Failed!")}})},onFinishconnectSAPPress:function(){var e=this.getView();var t=e.byId("idDescriptionInput").getValue();var i=e.byId("idSystemIdInput").getValue();var n=e.byId("idInstanceNumberInput").getValue();var o=e.byId("idClientInput").getValue();var r=e.byId("idApplicationServerInput").getValue();var a=e.byId("idRouterStringInput").getValue();var u=e.byId("idServiceInput").getValue();var d=e.byId("idCheckboxDescription");var l=true;var c=true;if(!d.getSelected()&&!t){e.byId("idDescriptionInput").setValueState("Error");e.byId("idDescriptionInput").setValueStateText("Description is mandatory when checkbox is not selected.");l=false;c=false}else{e.byId("idDescriptionInput").setValueState("None")}if(!i){e.byId("idSystemIdInput").setValueState("Error");e.byId("idSystemIdInput").setValueStateText("System ID must be a 3-digit value");l=false;c=false}else{e.byId("idSystemIdInput").setValueState("None")}if(!n){e.byId("idInstanceNumberInput").setValueState("Error");e.byId("idInstanceNumberInput").setValueStateText("InstanceNumber must be a 3-digit value");l=false;c=false}else{e.byId("idInstanceNumberInput").setValueState("None")}if(!o){e.byId("idClientInput").setValueState("Error");e.byId("idClientInput").setValueStateText("clientID must be a 3-digit value");l=false;c=false}else{e.byId("idClientInput").setValueState("None")}if(!r){e.byId("idApplicationServerInput").setValueState("Error");l=false;c=false}else{e.byId("idApplicationServerInput").setValueState("None")}if(!c){sap.m.MessageToast.show("Please fill all mandatory details");return}if(!l){sap.m.MessageToast.show("Please enter correct data");return}var p=this.getOwnerComponent().getModel("ModelV2");p.read("/ServiceSet",{filters:[new sap.ui.model.Filter("Description",sap.ui.model.FilterOperator.EQ,t)],filters:[new sap.ui.model.Filter("Client",sap.ui.model.FilterOperator.EQ,o)],success:function(l){var c=[];if(l.results.length>0){if(l.results.some(e=>e.Client===o)){c.push("The Client must be unique.")}if(l.results.some(e=>e.Description===t)){c.push("The Description must be unique.")}if(c.length>0){s.show(c.join("\n"));return}}var I=new sap.m.Button({type:"Emphasized",width:"11rem",customData:[new sap.ui.core.CustomData({key:"systemId",value:i})]});if(d.getSelected()){I.setText(i+" / "+o)}else{I.setText(t)}I.attachPress(this.onConfiguredSystemButtonPress.bind(this,I,t,i,o));I.attachBrowserEvent("dblclick",function(){this.LoadSapLogon()}.bind(this));var h={Description:t,SystemId:i,InstanceNo:n,Client:o,AppServer:r,SapRouterStr:a,SapService:u,DescriptionB:d.getSelected()?i+" / "+o:t};p.create("/ServiceSet",h,{success:function(){s.show("Configured system saved successfully.");this.clearInputFields(e);var t=e.byId("environmentButtonsHBox");var i=e.byId("_IDCofiguresapLink");t.insertItem(I,t.indexOfItem(i)+1);p.refresh(true);this.getView().byId("pageInitial").getModel("ModelV2").refresh(true)}.bind(this),error:function(e){s.show("Error saving configured system.")}});this.onCloseconnectsap()}.bind(this),error:function(e){s.show("Error checking existing systems.")}})},clearInputFields:function(e){e.byId("idDescriptionInput").setValue("");e.byId("idSystemIdInput").setValue("");e.byId("idInstanceNumberInput").setValue("");e.byId("idClientInput").setValue("");e.byId("idApplicationServerInput").setValue("");e.byId("idRouterStringInput").setValue("");e.byId("idServiceInput").setValue("");var t=e.byId("idCheckboxDescription");t.setSelected(false)},onConfiguredSystemButtonPress:function(e,t,s,i,n){this.selectedButton=e;this.client=i;this.sdedescription=e.mProperties.text},onClearconnectSAPPress:function(){var e=this.getView();this.clearInputFields(e)},onDeleteConfiguredSystem:function(e){if(!this.selectedButton){s.show("No System selected for deletion.");return}var t=this;i.warning("Delete the selected system?",{title:"Delete",actions:[i.Action.DELETE,i.Action.CANCEL],onClose:function(e){if(e===i.Action.DELETE){var n=t.getView().getModel("ModelV2");var o="/ServiceSet('"+this.client+"')";n.remove(o,{success:function(){s.show("Configured system deleted successfully.");var e=t.getView().byId("environmentButtonsHBox");e.removeItem(t.selectedButton);var i=t.aAllButtons.indexOf(t.selectedButton);if(i!==-1){t.aAllButtons.splice(i,1)}t.selectedButton=null;t.updateDisplayedButtons();var i=t.aAllButtons.indexOf(t.selectedButton);if(i!==-1){t.aAllButtons.splice(i,1)}t.selectedButton=null;t.updateDisplayedButtons()}.bind(t),error:function(e){s.show("Error deleting configured system.");console.error(e)}})}else{s.show("Deletion cancelled.");this.selectedButton=null}}.bind(t)})},onEditConfiguredSystem:async function(){if(!this.selectedButton){s.show("No System selected to edit.");return}await this.handleLinksapPress();this.getView().byId("idconnectsapfinishButton").setVisible(false);this.getView().byId("idconnectsapeditButton").setVisible(true);var e=this.sdedescription;var t=this.getView().getModel("ModelV2");var i=this;t.read("/ServiceSet",{filters:[new sap.ui.model.Filter("DescriptionB",sap.ui.model.FilterOperator.EQ,e)],success:function(t){var s=t.results;function n(t){return t.DescriptionB===e}var o=s.filter(n);if(o){i.byId("idDescriptionInput").setValue(o[0].Description);i.byId("idSystemIdInput").setValue(o[0].SystemId);i.byId("idInstanceNumberInput").setValue(o[0].InstanceNo);i.byId("idClientInput").setValue(o[0].Client);i.byId("idApplicationServerInput").setValue(o[0].AppServer);i.byId("idRouterStringInput").setValue(o[0].SapRouterStr);i.byId("idServiceInput").setValue(o[0].SapService)}}})},onEditconnectSAPPress:function(){var e=this.getView();var t=e.byId("idDescriptionInput").getValue();var s=e.byId("idSystemIdInput").getValue();var i=e.byId("idInstanceNumberInput").getValue();var n=e.byId("idClientInput").getValue();var o=e.byId("idApplicationServerInput").getValue();var r=e.byId("idRouterStringInput").getValue();var a=e.byId("idServiceInput").getValue();var u=e.byId("idCheckboxDescription");var d=this.selectedButton;if(!s){sap.m.MessageToast.show("System ID is required.");return}if(!i){sap.m.MessageToast.show("Instance Number is required.");return}if(!n){sap.m.MessageToast.show("Client is required.");return}if(!o){sap.m.MessageToast.show("Application Server is required.");return}if(!a){sap.m.MessageToast.show("Service is required.");return}if(u.getSelected()){t=s+" / "+n}d.setText(t);var l={Description:t,DescriptionB:t,SystemId:s,InstanceNo:i,Client:n,AppServer:o,SapRouterStr:r,SapService:a};var c=this;var p=this.getView().getModel("ModelV2");p.update("/ServiceSet('"+n+"')",l,{success:function(){sap.m.MessageToast.show("system Configuration updated successfully");c.clearInputFields(e);c.onCloseconnectsap()},error:function(e){sap.m.MessageToast.show("Error updating data.")}})},onBackconnectSAPPress:function(){this.onCloseconnectsap();this.selectedButton=null},onToggleButtonPress:function(e){const t=e.getSource();t.setPressed(!t.getPressed())},loadConfiguredSystems:function(){var e=this.getOwnerComponent().getModel("ModelV2");e.read("/ServiceSet",{success:function(e){var t=e.results;this.aAllButtons=[];for(var s=0;s<t.length;s++){var i=t[s];var n=new sap.m.Button({text:i.DescriptionB,type:"Emphasized",width:"11rem"});n.attachPress(this.onConfiguredSystemButtonPress.bind(this,n,i.Description,i.SystemId,i.Client));n.attachBrowserEvent("dblclick",function(){this.LoadSapLogon()}.bind(this));this.aAllButtons.push(n)}this.updateDisplayedButtons()}.bind(this),error:function(e){s.show("Error loading configured systems.");console.error(e)}})},updateDisplayedButtons:function(){var e=this.getView().byId("environmentButtonsHBox");e.addItem(this.getView().byId("upNavigationButtonId"));var t=Math.min(3,this.aAllButtons.length-this.currentIndex);for(var s=0;s<this.aAllButtons.length;s++){if(s>=this.currentIndex&&s<this.currentIndex+t){this.aAllButtons[s].setVisible(true)}else{this.aAllButtons[s].setVisible(false)}if(this.aAllButtons[s].getVisible()){e.addItem(this.aAllButtons[s])}}e.addItem(this.getView().byId("downNavigationButtonId"))},onNavPrevious:function(){if(this.currentIndex+3<this.aAllButtons.length){this.currentIndex+=3;this.updateDisplayedButtons();this.getView().byId("upNavigationButtonId").setVisible(true)}else{s.show("No more Systems to display.")}},onNavNext:function(){if(this.currentIndex-3>=0){this.currentIndex-=3;this.updateDisplayedButtons();if(this.currentIndex===0){this.getView().byId("upNavigationButtonId").setVisible(false)}}else{s.show("No previous buttons to display.")}}})});
//# sourceMappingURL=InitialScreen.controller.js.map